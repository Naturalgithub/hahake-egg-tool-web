import{d as I,j as f,r as u,o as b,c as R,e as o,i as l,f as y,g as r,t as d,u as m,k as S,h,l as C,m as P,E as _}from"./index-61c1a13e.js";import{g as q,u as O,s as j,f as J,a as K,b as W,c as Y,d as z,e as F}from"./ns-107a6c9a.js";import{_ as G}from"./index.vue_vue_type_script_setup_true_name_ProTable_lang-ad82a428.js";import{b as Q,c as X}from"./dict-b24c12c9.js";import{_ as Z}from"./hd-drawer.vue_vue_type_script_setup_true_name_UserDrawer_lang-66cce531.js";import{_ as ee}from"./hd-update-number.vue_vue_type_script_setup_true_name_HdUpdateNumberDrawerRef_lang-b49038b6.js";import"./message-532cbf74.js";const ae={class:"table-box main"},te={class:"p-5"},oe=I({name:"useProTable"}),ue=I({...oe,setup(le){const p=f(),x=[{type:"expand",label:"Expand",width:100},{prop:"deviceId",label:"deviceId",sortable:!0,search:{el:"input"}},{prop:"userName",label:"userName"},{prop:"brand",label:"brand",enum:Q},{prop:"allowPay",label:"allowPay",width:130},{prop:"serviceCharge",label:"serviceCharge"},{prop:"audit",label:"是否补录",enum:X,search:{el:"select",props:{filterable:!0}}},{prop:"createTime",label:"createTime"},{prop:"updateTime",label:"updateTime"},{prop:"userMobile",label:"userMobile"},{prop:"operation",label:"操作",fixed:"right",width:250}],T={type:1},D=e=>({list:e.records.map(t=>({...t,allowPay:!!t.allowPay})),total:e.total}),w=f(null),v=f(null),g=(e,t={})=>{var n;const i={title:e,isView:e==="查看",rowData:{...t},api:e==="新增"?N:e==="编辑"?V:void 0,getTableList:p.value.getTableList};(n=w.value)==null||n.acceptParams(i)},L=(e,t={})=>{var n;const i={title:e,isView:!1,rowData:{...t},api:O,getTableList:p.value.getTableList};(n=v.value)==null||n.acceptParams(i)},N=async()=>{},V=async e=>{e.ownerName=e.userName,e.ownerPhone=e.userMobile,await j(e)},$=e=>{e.bb=22},B=async e=>{const{rows:t}=await J(e.deviceId);e.packList=t},A=async e=>{const t=await K(e.deviceId);e.areaList=t||[]},E=async e=>{const t=await W(e.deviceId);if(e.pointInfo=t[0],t[0]){const[i,n]=t[0].coordinates.split(","),c=await Y(i,n);e.pointInfoAddress=JSON.stringify(c)}},H=async(e,t)=>{if(t.allowPay!==null)try{await z({enable:e,id:t.id}),_.success("操作成功"),p.value.getTableList()}catch(i){_.error(i)}},U=async e=>{try{await F({deviceIds:[e.deviceId]}),_.success("同步成功!"),p.value.getTableList()}catch(t){_.error(t)}};return(e,t)=>{const i=u("el-divider"),n=u("el-button"),c=u("el-table-column"),k=u("el-table"),M=u("el-switch");return b(),R("div",ae,[o(G,{ref_key:"proTable",ref:p,title:"用户列表",columns:x,"highlight-current-row":"",rowKey:"id",requestApi:m(q),initParam:T,dataCallback:D,onExpandChange:$},{expand:l(a=>[y("div",te,[o(i,null,{default:l(()=>[r("查看设备"+d(a.row.deviceId)+"历史作业面积",1)]),_:2},1024),o(n,{onClick:s=>A(a.row)},{default:l(()=>[r("获取历史作业面积")]),_:2},1032,["onClick"]),o(k,{style:{"margin-right":"20px","margin-top":"10px"},data:a.row.areaList,border:""},{default:l(()=>[o(c,{prop:"year",label:"year "}),o(c,{prop:"total_area",label:"total_area"})]),_:2},1032,["data"]),o(i,null,{default:l(()=>[r("查看设备"+d(a.row.deviceId)+"打包信息",1)]),_:2},1024),o(n,{onClick:s=>B(a.row)},{default:l(()=>[r("获取打包信息")]),_:2},1032,["onClick"]),o(k,{style:{"margin-right":"20px","margin-top":"10px"},data:a.row.packList,border:""},{default:l(()=>[o(c,{prop:"serialId",label:"包号 ",width:"220"}),o(c,{prop:"content",label:"打包内容"}),o(c,{prop:"opTime",label:"打包时间"})]),_:2},1032,["data"]),o(i,null,{default:l(()=>[r("查看设备"+d(a.row.deviceId)+"最后一次上点信息",1)]),_:2},1024),o(n,{onClick:s=>E(a.row)},{default:l(()=>[r("获取上点信息")]),_:2},1032,["onClick"]),y("p",null,d(a.row.pointInfo),1),r(" 反查地址： "),y("p",null,d(a.row.pointInfoAddress),1)])]),payed:l(({row:a})=>[r(d(a.payed?"是":"否"),1)]),audit:l(({row:a})=>[r(d(a.audit?"是":"否"),1)]),allowPay:l(a=>[o(M,{onChange:s=>H(s,a.row),modelValue:a.row.allowPay,"onUpdate:modelValue":s=>a.row.allowPay=s,"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"是","inactive-text":"否"},null,8,["onChange","modelValue","onUpdate:modelValue"])]),operation:l(a=>[o(n,{type:"primary",link:"",onClick:s=>L("更新日期",a.row)},{default:l(()=>[r("更新日期")]),_:2},1032,["onClick"]),o(n,{type:"primary",link:"",icon:m(S),onClick:s=>U(a.row)},{default:l(()=>[r("同步")]),_:2},1032,["icon","onClick"]),a.row.audit?P("",!0):(b(),h(n,{key:0,type:"primary",link:"",icon:m(C),onClick:s=>g("编辑",a.row)},{default:l(()=>[r("补录")]),_:2},1032,["icon","onClick"])),a.row.audit?(b(),h(n,{key:1,type:"primary",link:"",icon:m(C),onClick:s=>g("编辑",a.row)},{default:l(()=>[r("更新补录")]),_:2},1032,["icon","onClick"])):P("",!0)]),_:1},8,["requestApi"]),o(Z,{ref_key:"HdDrawerRef",ref:w},null,512),o(ee,{ref_key:"HdUpdateNumberDrawerRef",ref:v},null,512)])}}});export{ue as default};
